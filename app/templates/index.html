<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Summarizer</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        .item-container {
            border: 1px dashed #ccc;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
        }
        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
        }
        .summary-container {
            border-left: 4px solid #3B82F6;
            padding-left: 1rem;
        }
        /* 사이드바 스타일 */
        .sidebar {
            width: 250px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #1a202c;
            color: white;
            transition: transform 0.3s ease;
            z-index: 50;
        }
        .sidebar-toggle {
            display: none;
        }
        .main-content {
            margin-left: 250px;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .sidebar-toggle {
                display: block;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 51;
            }
            .main-content {
                margin-left: 0;
            }
        }
        .history-item {
            transition: all 0.2s ease;
        }
        .history-item:hover {
            background-color: #2d3748;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- 사이드바 토글 버튼 -->
    <button id="sidebarToggle" class="sidebar-toggle p-2 bg-blue-600 text-white rounded">
        <i class="fas fa-bars"></i>
    </button>

    <!-- 사이드바 -->
    <aside id="sidebar" class="sidebar overflow-y-auto">
        <div class="p-4 border-b border-gray-800">
            <h2 class="text-xl font-bold">Summer AI</h2>
        </div>
        
        <!-- 사이드바 탭 -->
        <div class="border-b border-gray-800">
            <div class="flex flex-col">
                <button id="tab-summary" class="px-4 py-2 text-left bg-blue-600 text-white hover:bg-blue-700">
                    <i class="fas fa-file-alt mr-2"></i>요약
                </button>
                <button id="tab-manage" class="px-4 py-2 text-left hover:bg-gray-700">
                    <i class="fas fa-cog mr-2"></i>채널/키워드
                </button>
                <div id="manage-subtabs" class="pl-4 hidden">
                    <button id="tab-channels" class="w-full px-4 py-2 text-left hover:bg-gray-700">
                        <i class="fab fa-youtube mr-2"></i>채널
                    </button>
                    <button id="tab-keywords" class="w-full px-4 py-2 text-left hover:bg-gray-700">
                        <i class="fas fa-search mr-2"></i>키워드
                    </button>
                    <button id="tab-reports" class="w-full px-4 py-2 text-left hover:bg-gray-700">
                        <i class="fas fa-chart-bar mr-2"></i>리포트
                    </button>
                </div>
                <button id="tab-history" class="px-4 py-2 text-left hover:bg-gray-700">
                    <i class="fas fa-history mr-2"></i>히스토리
                </button>
            </div>
        </div>
        
        <!-- 요약 탭 콘텐츠 -->
        <div id="summary-tab-content" class="p-4">
            <p class="text-sm mb-4">다양한 유형의 콘텐츠를 빠르게 요약하세요.</p>
            <div class="space-y-3">
                <button id="side-add-text" class="w-full px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-left">
                    <i class="fas fa-font mr-2"></i>텍스트 요약
                </button>
                <button id="side-add-youtube" class="w-full px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-left">
                    <i class="fab fa-youtube mr-2"></i>유튜브 요약
                </button>
                <button id="side-add-document" class="w-full px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-left">
                    <i class="fas fa-file-alt mr-2"></i>문서 요약
                </button>
            </div>
        </div>
        
        <!-- 채널/키워드 탭 콘텐츠 -->
        <div id="manage-tab-content" class="p-4 hidden">
            <p class="text-sm mb-4">채널과 키워드를 관리하고 리포트를 확인하세요.</p>
            <div class="space-y-3">
                <a href="/manage" class="block w-full px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-left">
                    <i class="fas fa-cog mr-2"></i>관리 페이지로 이동
                </a>
            </div>
        </div>
        
        <!-- 히스토리 탭 콘텐츠 -->
        <div id="history-tab-content" class="p-4 hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-sm font-medium">최근 요약</h3>
                <button id="refresh-history" class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div id="history-items" class="space-y-2">
                <p class="text-xs text-gray-400 text-center p-4">로딩 중...</p>
            </div>
        </div>
        
        <!-- 사용자 인증 영역 -->
        <div class="mt-auto p-4 border-t border-gray-800">
            <div id="auth-container">
                <!-- 인증 상태에 따라 동적으로 채워질 영역 -->
                <div class="text-center">
                    <div class="loading-spinner inline-block animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- 메인 콘텐츠 -->
    <div class="main-content">
        <div class="container mx-auto px-4 py-8">
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Summer AI</h1>
                <p class="text-gray-600">Easily summarize text, YouTube videos, and documents.</p>
            </header>

            <!-- 네비게이션 탭 -->
            <div class="max-w-5xl mx-auto mb-6">
                <div class="flex border-b border-gray-200">
                    <a href="javascript:void(0);" class="tab-link px-6 py-3 text-center border-b-2 border-indigo-500 font-medium text-indigo-600" data-target="/">
                        <i class="fas fa-home mr-2"></i>홈
                    </a>
                    <a href="javascript:void(0);" class="tab-link px-6 py-3 text-center text-gray-600 hover:text-gray-800 font-medium" data-target="/manage">
                        <i class="fas fa-cog mr-2"></i>관리
                    </a>
                    <a href="javascript:void(0);" class="tab-link px-6 py-3 text-center text-gray-600 hover:text-gray-800 font-medium" data-target="/history">
                        <i class="fas fa-history mr-2"></i>히스토리
                    </a>
                </div>
            </div>

            <!-- 통합 요약 인터페이스 -->
            <div class="max-w-5xl mx-auto bg-white rounded-lg shadow-md p-6 original-content">
                <h2 class="text-2xl font-semibold mb-4">Multi-Item Summary</h2>
                <p class="text-gray-700 mb-4">Add multiple texts, YouTube links, and document files to summarize all at once.</p>
                
                <!-- 항목 추가 버튼 -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <button id="add-text-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
                        <i class="fas fa-font mr-2"></i>Add Text
                    </button>
                    <button id="add-youtube-btn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">
                        <i class="fab fa-youtube mr-2"></i>Add YouTube Link
                    </button>
                    <button id="add-document-btn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">
                        <i class="fas fa-file-alt mr-2"></i>Add Document
                    </button>
                </div>
                
                <!-- 공통 요약 설정 -->
                <div class="bg-gray-100 p-4 rounded-lg mb-6">
                    <h3 class="text-lg font-medium mb-2">Summary Settings</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="style-select" class="block text-sm font-medium text-gray-700 mb-1">Style</label>
                            <select id="style-select" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="simple">Concise</option>
                                <option value="detailed">Detailed</option>
                                <option value="expert">Expert</option>
                                <option value="beginner">Beginner-friendly</option>
                                <option value="academic">Academic</option>
                                <option value="creative">Creative</option>
                            </select>
                        </div>
                        <div>
                            <label for="format-select" class="block text-sm font-medium text-gray-700 mb-1">Output Format</label>
                            <select id="format-select" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="text">Plain Text</option>
                                <option value="bullet">Bullet Points</option>
                                <option value="structured">Structured</option>
                                <option value="qa">Q&A Format</option>
                            </select>
                        </div>
                        <div>
                            <label for="language-select" class="block text-sm font-medium text-gray-700 mb-1">Language</label>
                            <select id="language-select" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="en">English</option>
                                <option value="ko">Korean</option>
                                <option value="ja">Japanese</option>
                                <option value="zh">Chinese</option>
                            </select>
                        </div>
                        <div>
                            <label for="max-length-select" class="block text-sm font-medium text-gray-700 mb-1">Max Length</label>
                            <select id="max-length-select" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="200">200 characters</option>
                                <option value="500">500 characters</option>
                                <option value="1000">1000 characters</option>
                                <option value="custom">Custom</option>
                            </select>
                            <input type="number" id="custom-length" class="mt-2 w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 hidden" value="200" min="50" max="5000">
                        </div>
                    </div>
                </div>
                
                <!-- 항목 컨테이너 -->
                <div id="items-container" class="mb-6">
                    <!-- 여기에 동적으로 항목 추가 -->
                    <div class="text-gray-500 text-center p-4 border border-dashed rounded-lg">
                        Click the buttons above to add items for summarization.
                    </div>
                </div>
                
                <!-- 요약 버튼 -->
                <div class="text-center mb-6">
                    <button id="summarize-btn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium">
                        <i class="fas fa-magic mr-2"></i>Summarize All Items
                    </button>
                </div>
                
                <!-- 로딩 표시 -->
                <div id="loading" class="hidden text-center p-4">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-600"></div>
                    <p class="text-indigo-600 mt-2">Summarizing... Please wait...</p>
                </div>
                
                <!-- 요약 결과 -->
                <div id="results-container" class="hidden">
                    <h3 class="text-xl font-semibold mb-4 border-b pb-2">Summary Results</h3>
                    
                    <!-- 전체 요약 -->
                    <div id="overall-summary" class="mb-6 p-4 bg-indigo-50 rounded-lg hidden">
                        <h4 class="text-lg font-medium text-indigo-800 mb-2">Overall Summary</h4>
                        <div id="overall-summary-content" class="text-gray-800"></div>
                    </div>
                    
                    <!-- 개별 요약 결과 컨테이너 -->
                    <div id="individual-results"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM 요소
        const addTextBtn = document.getElementById('add-text-btn');
        const addYoutubeBtn = document.getElementById('add-youtube-btn');
        const addDocumentBtn = document.getElementById('add-document-btn');
        const itemsContainer = document.getElementById('items-container');
        const summarizeBtn = document.getElementById('summarize-btn');
        const loading = document.getElementById('loading');
        const resultsContainer = document.getElementById('results-container');
        const individualResults = document.getElementById('individual-results');
        const overallSummary = document.getElementById('overall-summary');
        const overallSummaryContent = document.getElementById('overall-summary-content');
        const maxLengthSelect = document.getElementById('max-length-select');
        const customLength = document.getElementById('custom-length');
        const authContainer = document.getElementById('auth-container');
        const mainContentArea = document.querySelector('.container.mx-auto.px-4.py-8');
        
        // 초기화 및 이벤트 리스너
        document.addEventListener('DOMContentLoaded', function() {
            // 인증 상태 확인
            checkAuthStatus();
            
            // 항목 추가 버튼 이벤트 리스너
            addTextBtn.addEventListener('click', addTextItem);
            addYoutubeBtn.addEventListener('click', addYoutubeItem);
            addDocumentBtn.addEventListener('click', addDocumentItem);
            
            // 요약 버튼 이벤트 리스너
            summarizeBtn.addEventListener('click', summarizeAll);
            
            // Max length select event listener
            maxLengthSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customLength.classList.remove('hidden');
                } else {
                    customLength.classList.add('hidden');
                }
            });
            
            // 첫 로드 시 안내 메시지 표시
            updateItemsContainer();
            
            // 사이드바 탭 전환 이벤트 리스너 설정
            setupSidebarTabs();
            
            // 네비게이션 탭 클릭 이벤트 설정
            setupNavigationTabs();
        });
        
        // 아이템 ID 카운터
        let itemCounter = 0;
        
        // 텍스트 항목 추가
        function addTextItem() {
            const itemId = `item-${++itemCounter}`;
            const html = `
                <div id="${itemId}" class="item-container p-4 mb-4 text-item">
                    <button class="remove-btn text-red-500 hover:text-red-700" onclick="removeItem('${itemId}')">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="mb-2">
                        <strong><i class="fas fa-font mr-1"></i> Text</strong>
                    </div>
                    <textarea class="w-full h-32 rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-content" placeholder="Enter text to summarize"></textarea>
                </div>
            `;
            appendItem(html);
        }
        
        // 유튜브 항목 추가
        function addYoutubeItem() {
            const itemId = `item-${++itemCounter}`;
            const html = `
                <div id="${itemId}" class="item-container p-4 mb-4 youtube-item">
                    <button class="remove-btn text-red-500 hover:text-red-700" onclick="removeItem('${itemId}')">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="mb-2">
                        <strong><i class="fab fa-youtube mr-1 text-red-600"></i> YouTube Link</strong>
                    </div>
                    <input type="url" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 url-content" placeholder="Enter YouTube URL (e.g., https://www.youtube.com/watch?v=...)">
                </div>
            `;
            appendItem(html);
        }
        
        // 문서 항목 추가
        function addDocumentItem() {
            const itemId = `item-${++itemCounter}`;
            const html = `
                <div id="${itemId}" class="item-container p-4 mb-4 document-item">
                    <button class="remove-btn text-red-500 hover:text-red-700" onclick="removeItem('${itemId}')">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="mb-2">
                        <strong><i class="fas fa-file-alt mr-1 text-green-600"></i> Document File</strong>
                    </div>
                    <input type="file" class="w-full p-2 border border-gray-300 rounded file-content" accept=".txt,.pdf,.doc,.docx">
                </div>
            `;
            appendItem(html);
        }
        
        // 항목 추가 공통 함수
        function appendItem(html) {
            // 안내 메시지가 있다면 제거
            clearPlaceholderMessage();
            
            // 항목 추가
            itemsContainer.insertAdjacentHTML('beforeend', html);
            
            // 컨테이너 상태 업데이트
            updateItemsContainer();
        }
        
        // 안내 메시지 제거
        function clearPlaceholderMessage() {
            const placeholder = itemsContainer.querySelector('.text-gray-500.text-center');
            if (placeholder) {
                placeholder.remove();
            }
        }
        
        // 항목 제거
        function removeItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
                updateItemsContainer();
            }
        }
        
        // 컨테이너 상태 업데이트
        function updateItemsContainer() {
            const hasItems = itemsContainer.querySelectorAll('.item-container').length > 0;
            
            if (!hasItems) {
                // 항목이 없을 때 안내 메시지 표시
                itemsContainer.innerHTML = `
                    <div class="text-gray-500 text-center p-4 border border-dashed rounded-lg">
                        Click the buttons above to add items for summarization.
                    </div>
                `;
            }
            
            // 요약 버튼 활성화/비활성화
            summarizeBtn.disabled = !hasItems;
            summarizeBtn.classList.toggle('opacity-50', !hasItems);
            summarizeBtn.classList.toggle('cursor-not-allowed', !hasItems);
        }
        
        // 모든 항목 요약
        function summarizeAll() {
            // 항목 확인
            const textItems = itemsContainer.querySelectorAll('.text-item');
            const youtubeItems = itemsContainer.querySelectorAll('.youtube-item');
            const documentItems = itemsContainer.querySelectorAll('.document-item');
            
            if (textItems.length === 0 && youtubeItems.length === 0 && documentItems.length === 0) {
                alert('Please add at least one item to summarize.');
                return;
            }
            
            // 로딩 시작
            loading.classList.remove('hidden');
            resultsContainer.classList.add('hidden');
            
            // 공통 설정 가져오기
            const style = document.getElementById('style-select').value;
            const format = document.getElementById('format-select').value;
            const language = document.getElementById('language-select').value;
            const maxLength = getMaxLength();
            
            // 배치 요약 요청 데이터 준비
            const batchRequest = {
                texts: [],
                youtube_urls: [],
                style: style,
                max_length: maxLength,
                language: language,
                format: format
            };
            
            // 텍스트 항목 추가
            textItems.forEach(item => {
                const textContent = item.querySelector('.text-content').value.trim();
                if (textContent) {
                    batchRequest.texts.push({
                        text: textContent,
                        style: style,
                        max_length: maxLength,
                        language: language,
                        format: format
                    });
                }
            });
            
            // 유튜브 항목 추가
            youtubeItems.forEach(item => {
                const url = item.querySelector('.url-content').value.trim();
                if (url) {
                    batchRequest.youtube_urls.push(url);
                }
            });
            
            // API 호출 (문서 항목은 별도 처리)
            fetch('/api/v1/batch-summarize', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(batchRequest)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('요약 요청에 실패했습니다.');
                }
                return response.json();
            })
            .then(async data => {
                // 문서 항목 별도 처리 (파일 업로드 필요)
                const documentPromises = [];
                documentItems.forEach(item => {
                    const fileInput = item.querySelector('.file-content');
                    if (fileInput.files.length > 0) {
                        documentPromises.push(processDocument(fileInput.files[0], style, maxLength, language, format));
                    }
                });
                
                // 문서 처리 완료 기다리기
                const documentResults = await Promise.all(documentPromises);
                
                // 결과 표시
                displayResults(data, documentResults);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('요약 처리 중 오류가 발생했습니다: ' + error.message);
            })
            .finally(() => {
                loading.classList.add('hidden');
            });
        }
        
        // 문서 처리 함수
        async function processDocument(file, style, maxLength, language, format) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('style', style);
            formData.append('max_length', maxLength);
            formData.append('language', language);
            formData.append('format', format);
            
            try {
                const response = await fetch('/api/v1/summarize/document', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error('문서 요약에 실패했습니다.');
                }
                
                return await response.json();
            } catch (error) {
                console.error('Document Error:', error);
                return {error: error.message, file_name: file.name};
            }
        }
        
        // 결과 표시 함수
        function displayResults(batchResults, documentResults) {
            // 결과 컨테이너 초기화
            individualResults.innerHTML = '';
            
            // 전체 요약 표시 (있는 경우)
            if (batchResults.overall_summary) {
                overallSummaryContent.textContent = batchResults.overall_summary;
                overallSummary.classList.remove('hidden');
            } else {
                overallSummary.classList.add('hidden');
            }
            
            // 텍스트 요약 결과 표시
            batchResults.text_summaries.forEach((result, index) => {
                const html = `
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-2">
                            <i class="fas fa-font mr-1"></i> Text Summary ${index + 1}
                        </h4>
                        ${result.error ? 
                            `<div class="text-red-600">오류: ${result.error}</div>` : 
                            `<div class="summary-container mt-2">${result.summary}</div>`
                        }
                        ${result.key_phrases && result.key_phrases.length > 0 ? 
                            `<div class="mt-4">
                                <h5 class="text-sm font-medium text-gray-700">주요 키워드</h5>
                                <div class="flex flex-wrap gap-2 mt-1">
                                    ${result.key_phrases.map(phrase => `
                                        <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">${phrase}</span>
                                    `).join('')}
                                </div>
                            </div>` : 
                            ''
                        }
                    </div>
                `;
                individualResults.insertAdjacentHTML('beforeend', html);
            });
            
            // 유튜브 요약 결과 표시
            batchResults.youtube_summaries.forEach((result, index) => {
                const html = `
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium text-red-800 mb-2">
                            <i class="fab fa-youtube mr-1"></i> YouTube Summary ${index + 1}
                        </h4>
                        ${result.error ? 
                            `<div class="text-red-600">오류: ${result.error}</div>` :
                            `<div class="mb-2">
                                <strong>${result.title || '제목 정보 없음'}</strong>
                                <span class="text-sm text-gray-600 ml-2">(${result.channel || '채널 정보 없음'})</span>
                            </div>
                            <div class="summary-container mt-2">${result.summary || result.transcript || '요약 실패'}</div>`
                        }
                    </div>
                `;
                individualResults.insertAdjacentHTML('beforeend', html);
            });
            
            // 문서 요약 결과 표시
            documentResults.forEach((result, index) => {
                const html = `
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium text-green-800 mb-2">
                            <i class="fas fa-file-alt mr-1"></i> Document Summary ${index + 1}
                        </h4>
                        ${result.error ? 
                            `<div class="text-red-600">오류: ${result.error}</div>` :
                            `<div class="mb-2">
                                <strong>${result.file_name || '파일명 정보 없음'}</strong>
                                <span class="text-sm text-gray-600 ml-2">(${result.file_extension || '확장자 정보 없음'}, ${formatFileSize(result.file_size)})</span>
                            </div>
                            <div class="summary-container mt-2">${result.summary || '요약 실패'}</div>`
                        }
                    </div>
                `;
                individualResults.insertAdjacentHTML('beforeend', html);
            });
            
            // 결과 컨테이너 표시
            resultsContainer.classList.remove('hidden');
            
            // 결과로 스크롤
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // 파일 크기 포맷
        function formatFileSize(bytes) {
            if (!bytes) return '크기 정보 없음';
            const units = ['B', 'KB', 'MB', 'GB'];
            let size = bytes;
            let unitIndex = 0;
            
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            
            return `${size.toFixed(1)} ${units[unitIndex]}`;
        }

        // 사이드바 토글 기능
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });

        // 사이드바 탭 설정 함수
        function setupSidebarTabs() {
            // 탭 버튼 요소
            const tabSummary = document.getElementById('tab-summary');
            const tabManage = document.getElementById('tab-manage');
            const tabHistory = document.getElementById('tab-history');
            const manageSubtabs = document.getElementById('manage-subtabs');
            
            // 탭 콘텐츠 요소
            const summaryContent = document.getElementById('summary-tab-content');
            const manageContent = document.getElementById('manage-tab-content');
            const historyContent = document.getElementById('history-tab-content');
            
            // 메인 콘텐츠 영역
            const mainContentArea = document.querySelector('.container.mx-auto.px-4.py-8');
            
            // 원본 메인 콘텐츠를 저장
            const originalMainContent = mainContentArea.innerHTML;
            
            // 모든 탭 비활성화 함수
            function deactivateAllTabs() {
                [tabSummary, tabManage, tabHistory].forEach(tab => {
                    tab.classList.remove('bg-blue-600');
                    tab.classList.add('hover:bg-gray-700');
                });
                
                [summaryContent, manageContent, historyContent].forEach(content => {
                    content.classList.add('hidden');
                });
                
                manageSubtabs.classList.add('hidden');
            }
            
            // 요약 탭
            tabSummary.addEventListener('click', function() {
                deactivateAllTabs();
                tabSummary.classList.add('bg-blue-600');
                tabSummary.classList.remove('hover:bg-gray-700');
                summaryContent.classList.remove('hidden');
                
                // 메인 콘텐츠 영역 복원
                const summaryTab = document.querySelector('.tab-link[data-target="/"]');
                if (summaryTab) {
                    summaryTab.click();
                } else {
                    mainContentArea.innerHTML = originalMainContent;
                    
                    // 필요한 이벤트 리스너 다시 설정
                    const addTextBtn = document.getElementById('add-text-btn');
                    const addYoutubeBtn = document.getElementById('add-youtube-btn');
                    const addDocumentBtn = document.getElementById('add-document-btn');
                    const summarizeBtn = document.getElementById('summarize-btn');
                    const maxLengthSelect = document.getElementById('max-length-select');
                    const customLength = document.getElementById('custom-length');
                    
                    if (addTextBtn) addTextBtn.addEventListener('click', addTextItem);
                    if (addYoutubeBtn) addYoutubeBtn.addEventListener('click', addYoutubeItem);
                    if (addDocumentBtn) addDocumentBtn.addEventListener('click', addDocumentItem);
                    if (summarizeBtn) summarizeBtn.addEventListener('click', summarizeAll);
                    
                    if (maxLengthSelect) {
                        maxLengthSelect.addEventListener('change', function() {
                            if (this.value === 'custom') {
                                customLength.classList.remove('hidden');
                            } else {
                                customLength.classList.add('hidden');
                            }
                        });
                    }
                    
                    updateItemsContainer();
                }
            });
            
            // 채널/키워드 탭
            tabManage.addEventListener('click', function() {
                deactivateAllTabs();
                tabManage.classList.add('bg-blue-600');
                tabManage.classList.remove('hover:bg-gray-700');
                manageContent.classList.remove('hidden');
                manageSubtabs.classList.remove('hidden');
            });
            
            // 히스토리 탭
            tabHistory.addEventListener('click', function() {
                deactivateAllTabs();
                tabHistory.classList.add('bg-blue-600');
                tabHistory.classList.remove('hover:bg-gray-700');
                historyContent.classList.remove('hidden');
                loadHistory();
                
                // 히스토리 페이지 내용을 로드
                loadHistoryPage();
            });
            
            // 하위 탭 이벤트 리스너
            document.getElementById('tab-channels').addEventListener('click', function(e) {
                e.preventDefault();
                console.log("채널 탭 클릭됨");
                // 메인 콘텐츠 영역에 관리 페이지 로드 
                loadManagePage('channels');
            });
            
            document.getElementById('tab-keywords').addEventListener('click', function(e) {
                e.preventDefault();
                console.log("키워드 탭 클릭됨");
                // 메인 콘텐츠 영역에 관리 페이지 로드
                loadManagePage('keywords');
            });
            
            document.getElementById('tab-reports').addEventListener('click', function(e) {
                e.preventDefault();
                alert('리포트 기능은 현재 개발 중입니다.');
            });
        }

        // 사이드바 버튼 이벤트
        document.getElementById('side-add-text').addEventListener('click', addTextItem);
        document.getElementById('side-add-youtube').addEventListener('click', addYoutubeItem);
        document.getElementById('side-add-document').addEventListener('click', addDocumentItem);
        document.getElementById('refresh-history').addEventListener('click', loadHistory);

        // 히스토리 불러오기
        function loadHistory() {
            const historyItems = document.getElementById('history-items');
            historyItems.innerHTML = '<p class="text-xs text-gray-400 text-center p-4">Loading...</p>';
            
            fetch('/api/v1/history/list')
                .then(response => response.json())
                .then(data => {
                    if (data.items && data.items.length > 0) {
                        historyItems.innerHTML = '';
                        data.items.forEach(item => {
                            const date = new Date(item.created_at);
                            const formattedDate = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                            
                            let icon = 'fas fa-file-alt';
                            let typeLabel = 'Text';
                            let bgColor = 'bg-blue-100';
                            let textColor = 'text-blue-800';
                            
                            if (item.summary_type === 'youtube') {
                                icon = 'fab fa-youtube';
                                typeLabel = 'YouTube';
                                bgColor = 'bg-red-100';
                                textColor = 'text-red-800';
                            } else if (item.summary_type === 'document') {
                                icon = 'fas fa-file-pdf';
                                typeLabel = 'Document';
                                bgColor = 'bg-green-100';
                                textColor = 'text-green-800';
                            }
                            
                            historyItems.innerHTML += `
                                <div class="history-item p-2 rounded cursor-pointer" onclick="showHistoryDetail(${item.id})">
                                    <div class="flex items-center">
                                        <div class="mr-2 ${bgColor} ${textColor} p-1 rounded">
                                            <i class="${icon}"></i>
                                        </div>
                                        <div class="flex-1 overflow-hidden">
                                            <div class="text-xs text-gray-400">${formattedDate}</div>
                                            <div class="text-sm truncate">${item.summary_text}</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        historyItems.innerHTML = '<p class="text-xs text-gray-400 text-center p-4">No history found.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error loading history:', error);
                    historyItems.innerHTML = '<p class="text-xs text-red-400 text-center p-4">An error occurred while loading history.</p>';
                });
        }

        // 히스토리 상세 정보 보기
        function showHistoryDetail(id) {
            fetch(`/api/v1/history/${id}`)
                .then(response => response.json())
                .then(item => {
                    if (item) {
                        // 결과 컨테이너 표시
                        resultsContainer.classList.remove('hidden');
                        
                        // 개별 결과 컨테이너 초기화
                        individualResults.innerHTML = '';
                        
                        // 결과 타입에 따라 다른 템플릿 사용
                        if (item.summary_type === 'text') {
                            const result = `
                                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                                    <h4 class="font-medium text-blue-800 mb-2">
                                        <i class="fas fa-file-alt mr-1"></i> Text Summary
                                    </h4>
                                    <div class="mb-4">
                                        <p class="text-gray-700">${item.original_text}</p>
                                    </div>
                                    <div class="summary-container mb-2">
                                        <p>${item.summary_text}</p>
                                    </div>
                                </div>
                            `;
                            individualResults.innerHTML = result;
                        } else if (item.summary_type === 'youtube') {
                            const sourceInfo = item.source_info || {};
                            const result = `
                                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                                    <h4 class="font-medium text-red-800 mb-2">
                                        <i class="fab fa-youtube mr-1"></i> YouTube Summary
                                    </h4>
                                    <div class="mb-2">
                                        <strong>${sourceInfo.video_title || 'No title available'}</strong>
                                        <span class="text-sm text-gray-600 ml-2">(${sourceInfo.channel_name || 'No channel info'})</span>
                                    </div>
                                    <div class="summary-container mb-2">
                                        <p>${item.summary_text}</p>
                                    </div>
                                </div>
                            `;
                            individualResults.innerHTML = result;
                        } else if (item.summary_type === 'document') {
                            const sourceInfo = item.source_info || {};
                            const result = `
                                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                                    <h4 class="font-medium text-green-800 mb-2">
                                        <i class="fas fa-file-alt mr-1"></i> Document Summary
                                    </h4>
                                    <div class="mb-2">
                                        <strong>${sourceInfo.file_name || 'No file name'}</strong>
                                        <span class="text-sm text-gray-600 ml-2">(${sourceInfo.file_type || 'No file type'})</span>
                                    </div>
                                    <div class="summary-container mb-2">
                                        <p>${item.summary_text}</p>
                                    </div>
                                </div>
                            `;
                            individualResults.innerHTML = result;
                        }
                        
                        // 스크롤 이동
                        resultsContainer.scrollIntoView({ behavior: 'smooth' });
                    }
                })
                .catch(error => {
                    console.error('Error fetching history detail:', error);
                    alert('An error occurred while fetching history details.');
                });
        }

        // Get max length value
        function getMaxLength() {
            if (maxLengthSelect.value === 'custom') {
                return parseInt(customLength.value);
            } else {
                return parseInt(maxLengthSelect.value);
            }
        }

        // 인증 상태 확인 함수
        async function checkAuthStatus() {
            const token = localStorage.getItem('access_token');
            
            if (!token) {
                // 로그인되지 않음
                authContainer.innerHTML = `
                    <p class="text-sm text-gray-400 mb-2">로그인하여 모든 기능 이용하기</p>
                    <div class="flex space-x-2">
                        <a href="/login" class="flex-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-center text-sm">
                            <i class="fas fa-sign-in-alt mr-1"></i>로그인
                        </a>
                        <a href="/register" class="flex-1 px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-center text-sm">
                            <i class="fas fa-user-plus mr-1"></i>회원가입
                        </a>
                    </div>
                `;
                return;
            }
            
            try {
                const response = await fetch('/api/v1/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    
                    // 로그인됨
                    authContainer.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center mr-2">
                                <span class="text-white font-bold">${user.username.charAt(0).toUpperCase()}</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium">${user.username}</p>
                                <p class="text-xs text-gray-400">${user.subscription_tier} 사용자</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <a href="/account" class="flex-1 px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-center text-sm">
                                <i class="fas fa-user-cog mr-1"></i>계정
                            </a>
                            <button id="logout-btn" class="flex-1 px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-center text-sm">
                                <i class="fas fa-sign-out-alt mr-1"></i>로그아웃
                            </button>
                        </div>
                    `;
                    
                    // 로그아웃 버튼 이벤트 리스너
                    document.getElementById('logout-btn').addEventListener('click', function() {
                        localStorage.removeItem('access_token');
                        window.location.reload();
                    });
                    
                } else {
                    // 토큰 만료 등의 이유로 인증 실패
                    localStorage.removeItem('access_token');
                    checkAuthStatus(); // 다시 확인
                }
            } catch (error) {
                console.error('인증 확인 오류:', error);
                authContainer.innerHTML = `
                    <p class="text-sm text-red-400">서버 연결 오류</p>
                    <div class="flex space-x-2 mt-2">
                        <a href="/login" class="flex-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-center text-sm">로그인</a>
                        <a href="/register" class="flex-1 px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-center text-sm">회원가입</a>
                    </div>
                `;
            }
        }

        // 네비게이션 탭 설정
        function setupNavigationTabs() {
            const tabLinks = document.querySelectorAll('.tab-link');
            
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 활성 상태 초기화
                    tabLinks.forEach(tab => {
                        tab.classList.remove('border-b-2', 'border-indigo-500', 'text-indigo-600');
                        tab.classList.add('text-gray-600', 'hover:text-gray-800');
                    });
                    
                    // 클릭한 탭 활성화
                    this.classList.add('border-b-2', 'border-indigo-500', 'text-indigo-600');
                    this.classList.remove('text-gray-600', 'hover:text-gray-800');
                    
                    // 타겟 결정
                    const target = this.getAttribute('data-target');
                    
                    if (target === '/') {
                        // 홈으로 돌아가기
                        const originalContent = mainContentArea.querySelector('.original-content');
                        if (originalContent) {
                            originalContent.style.display = 'block';
                        } else {
                            navigateTo('/', mainContentArea);
                        }
                    } else if (target === '/manage') {
                        // 관리 페이지 로드
                        loadManagePage('channels');
                    } else if (target === '/history') {
                        // 히스토리 페이지 로드
                        loadHistoryPage();
                    }
                });
            });
        }

        // 관리 페이지 콘텐츠 로드 함수
        function loadManagePage(activeTab = 'channels') {
            // 메인 컨텐츠 영역에 관리 템플릿 생성
            mainContentArea.innerHTML = `
                <div class="container">
                    <div class="header">
                        <h1>유튜브 채널 및 키워드 관리</h1>
                    </div>
                    
                    <!-- 네비게이션 탭 -->
                    <div class="navigation-tabs mb-6">
                        <div class="flex border-b border-gray-200">
                            <a href="javascript:void(0);" class="tab-link px-6 py-3 text-center text-gray-600 hover:text-gray-800 font-medium" data-target="/">
                                <i class="fas fa-home mr-2"></i>홈
                            </a>
                            <a href="javascript:void(0);" class="tab-link px-6 py-3 text-center border-b-2 border-indigo-500 font-medium text-indigo-600" data-target="/manage">
                                <i class="fas fa-cog mr-2"></i>채널/키워드
                            </a>
                            <a href="javascript:void(0);" class="tab-link px-6 py-3 text-center text-gray-600 hover:text-gray-800 font-medium" data-target="/history">
                                <i class="fas fa-history mr-2"></i>히스토리
                            </a>
                            <a href="#" id="report-tab" class="px-6 py-3 text-center text-gray-600 hover:text-gray-800 font-medium">
                                <i class="fas fa-chart-bar mr-2"></i>리포트
                            </a>
                        </div>
                    </div>
                    
                    <div id="message" class="message"></div>
                    
                    <div class="tabs">
                        <div class="tab" id="channels-tab" onclick="switchTab('channels')">채널 관리</div>
                        <div class="tab" id="keywords-tab" onclick="switchTab('keywords')">키워드 관리</div>
                    </div>
                    
                    <div id="channels" class="tab-content">
                        <h2>채널 관리</h2>
                        
                        <form id="addChannelForm">
                            <div class="form-group">
                                <label for="channelId">채널 ID 또는 URL</label>
                                <input type="text" id="channelId" placeholder="예: UCdUcjkyZtf-1WJyPPiETF1g, https://www.youtube.com/channel/UCdUcjkyZtf-1WJyPPiETF1g, https://www.youtube.com/@yunjadong, @yunjadong">
                                <p class="form-hint">채널 ID, 전체 URL, 또는 @핸들(예: @yunjadong)을 입력할 수 있습니다.</p>
                            </div>
                            <button type="submit">채널 추가</button>
                        </form>
                        
                        <div class="list-container">
                            <h3 class="list-title">등록된 채널</h3>
                            <div id="channelList">
                                <!-- 채널 목록이 여기에 동적으로 추가됩니다 -->
                                <div class="loading">채널 목록을 불러오는 중...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="keywords" class="tab-content">
                        <h2>키워드 관리</h2>
                        
                        <form id="addKeywordForm">
                            <div class="form-group">
                                <label for="keyword">키워드</label>
                                <input type="text" id="keyword" placeholder="검색할 키워드 입력">
                            </div>
                            <button type="submit">키워드 추가</button>
                        </form>
                        
                        <div class="list-container">
                            <h3 class="list-title">등록된 키워드</h3>
                            <div id="keywordList">
                                <!-- 키워드 목록이 여기에 동적으로 추가됩니다 -->
                                <div class="loading">키워드 목록을 불러오는 중...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-results">
                        <h2>검색 결과</h2>
                        <div class="filter-controls" id="videoFilters" style="display: none;">
                            <input type="text" id="videoSearchInput" class="search-input" placeholder="검색 결과 내 검색...">
                            <select id="videoSortSelect">
                                <option value="date_desc">최신순</option>
                                <option value="date_asc">오래된순</option>
                                <option value="views_desc">조회수 높은순</option>
                                <option value="views_asc">조회수 낮은순</option>
                                <option value="title_asc">제목 오름차순</option>
                                <option value="title_desc">제목 내림차순</option>
                            </select>
                            <span id="resultCount"></span>
                        </div>
                        <div id="videoResults" class="video-grid">
                            <!-- 비디오 검색 결과가 여기에 표시됩니다 -->
                        </div>
                    </div>
                    
                    <div id="summaryResult" class="summary-result" style="display: none;">
                        <!-- 요약 결과가 여기에 표시됩니다 -->
                    </div>
                </div>
            `;
            
            // 네비게이션 탭 이벤트 리스너 설정
            setupNavigationTabs();
            
            // CSS 추가
            const style = document.createElement('style');
            style.textContent = `
                .tabs {
                    display: flex;
                    margin-bottom: 20px;
                }
                
                .tab {
                    padding: 10px 20px;
                    background-color: #f0f0f0;
                    border: 1px solid #ddd;
                    cursor: pointer;
                    margin-right: 5px;
                    border-radius: 4px 4px 0 0;
                }
                
                .tab.active {
                    background-color: #fff;
                    border-bottom: 2px solid #4f46e5;
                    font-weight: bold;
                }
                
                .tab-content {
                    display: none;
                    padding: 20px;
                    border: 1px solid #ddd;
                    border-radius: 0 4px 4px 4px;
                    margin-bottom: 20px;
                }
                
                .tab-content.active {
                    display: block;
                }
                
                .form-group {
                    margin-bottom: 15px;
                }
                
                .form-group label {
                    display: block;
                    margin-bottom: 5px;
                    font-weight: bold;
                }
                
                .form-group input {
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                }
                
                .form-hint {
                    font-size: 0.8em;
                    color: #666;
                    margin-top: 5px;
                }
                
                .list-container {
                    margin-top: 20px;
                }
                
                .list-title {
                    margin-bottom: 10px;
                    font-size: 1.1em;
                    font-weight: bold;
                }
                
                .channel-item, .keyword-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px;
                    border: 1px solid #ddd;
                    margin-bottom: 5px;
                    border-radius: 4px;
                }
                
                .channel-info, .keyword-info {
                    flex-grow: 1;
                }
                
                .channel-title, .keyword-text {
                    font-weight: bold;
                }
                
                .channel-id, .keyword-date {
                    font-size: 0.8em;
                    color: #666;
                }
                
                .action-btn {
                    background-color: transparent;
                    border: none;
                    cursor: pointer;
                    font-size: 1.2em;
                    color: #666;
                    transition: color 0.3s;
                }
                
                .action-btn:hover {
                    color: #f00;
                }
                
                .loading {
                    text-align: center;
                    padding: 20px;
                    color: #666;
                }
                
                .message {
                    padding: 10px;
                    margin-bottom: 15px;
                    border-radius: 4px;
                    display: none;
                }
                
                .message.success {
                    background-color: #d1e7dd;
                    color: #0f5132;
                    display: block;
                }
                
                .message.error {
                    background-color: #f8d7da;
                    color: #842029;
                    display: block;
                }
                
                .search-input {
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    margin-right: 10px;
                }
                
                button {
                    padding: 8px 16px;
                    background-color: #4f46e5;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                }
                
                button:hover {
                    background-color: #4338ca;
                }
                
                .video-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                    gap: 20px;
                    margin-top: 20px;
                }
                
                .video-card {
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    overflow: hidden;
                }
                
                .video-thumbnail {
                    width: 100%;
                    height: auto;
                }
                
                .video-info {
                    padding: 10px;
                }
                
                .video-title {
                    font-weight: bold;
                    margin-bottom: 5px;
                }
                
                .video-meta {
                    display: flex;
                    justify-content: space-between;
                    font-size: 0.8em;
                    color: #666;
                }
                
                .filter-controls {
                    display: flex;
                    align-items: center;
                    margin-top: 10px;
                }
            `;
            document.head.appendChild(style);
            
            // 탭 스위치 함수 정의
            window.switchTab = function(tabId) {
                console.log(`Switching to tab: ${tabId}`);
                
                // 모든 탭 컨텐츠 숨기기
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // 모든 탭 버튼 비활성화
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // 선택한 탭 컨텐츠 표시
                const tabContent = document.getElementById(tabId);
                if (tabContent) {
                    tabContent.classList.add('active');
                }
                
                // 선택한 탭 버튼 활성화
                const tabButton = document.getElementById(`${tabId}-tab`);
                if (tabButton) {
                    tabButton.classList.add('active');
                }
            };
            
            // 데이터 로드 함수
            function loadChannels() {
                const channelList = document.getElementById('channelList');
                if (!channelList) return;
                
                channelList.innerHTML = '<div class="loading">채널 목록을 불러오는 중...</div>';
                
                fetch('/api/v1/youtube/channels/')
                    .then(response => response.json())
                    .then(data => {
                        if (!data || data.length === 0) {
                            channelList.innerHTML = '<div class="text-center py-4">등록된 채널이 없습니다.</div>';
                            return;
                        }
                        
                        channelList.innerHTML = '';
                        data.forEach(channel => {
                            const channelItem = document.createElement('div');
                            channelItem.className = 'channel-item';
                            channelItem.innerHTML = `
                                <div class="channel-info">
                                    <div class="channel-title">${channel.title}</div>
                                    <div class="channel-id">${channel.channel_id}</div>
                                </div>
                                <button class="action-btn delete-channel" data-id="${channel.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            `;
                            channelList.appendChild(channelItem);
                        });
                        
                        // 삭제 버튼 이벤트 리스너
                        document.querySelectorAll('.delete-channel').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const channelId = this.getAttribute('data-id');
                                if (confirm('이 채널을 삭제하시겠습니까?')) {
                                    deleteChannel(channelId);
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('채널 로드 오류:', error);
                        channelList.innerHTML = '<div class="text-center py-4 text-red-500">채널 목록을 불러오는 중 오류가 발생했습니다.</div>';
                    });
            }
            
            function loadKeywords() {
                const keywordList = document.getElementById('keywordList');
                if (!keywordList) return;
                
                keywordList.innerHTML = '<div class="loading">키워드 목록을 불러오는 중...</div>';
                
                fetch('/api/v1/youtube/keywords/')
                    .then(response => response.json())
                    .then(data => {
                        if (!data || data.length === 0) {
                            keywordList.innerHTML = '<div class="text-center py-4">등록된 키워드가 없습니다.</div>';
                            return;
                        }
                        
                        keywordList.innerHTML = '';
                        data.forEach(keyword => {
                            const keywordItem = document.createElement('div');
                            keywordItem.className = 'keyword-item';
                            keywordItem.innerHTML = `
                                <div class="keyword-info">
                                    <div class="keyword-text">${keyword.keyword}</div>
                                    <div class="keyword-date">추가일: ${new Date(keyword.created_at).toLocaleDateString()}</div>
                                </div>
                                <button class="action-btn delete-keyword" data-id="${keyword.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            `;
                            keywordList.appendChild(keywordItem);
                        });
                        
                        // 삭제 버튼 이벤트 리스너
                        document.querySelectorAll('.delete-keyword').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const keywordId = this.getAttribute('data-id');
                                if (confirm('이 키워드를 삭제하시겠습니까?')) {
                                    deleteKeyword(keywordId);
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('키워드 로드 오류:', error);
                        keywordList.innerHTML = '<div class="text-center py-4 text-red-500">키워드 목록을 불러오는 중 오류가 발생했습니다.</div>';
                    });
            }
            
            // 삭제 함수
            function deleteChannel(id) {
                fetch(`/api/v1/youtube/channels/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        // 성공 메시지 표시
                        const messageDiv = document.getElementById('message');
                        messageDiv.textContent = '채널이 삭제되었습니다.';
                        messageDiv.className = 'message success';
                        
                        // 목록 새로고침
                        loadChannels();
                        
                        // 메시지 자동 사라짐
                        setTimeout(() => {
                            messageDiv.className = 'message';
                        }, 3000);
                    } else {
                        throw new Error('채널 삭제 실패');
                    }
                })
                .catch(error => {
                    // 오류 메시지 표시
                    const messageDiv = document.getElementById('message');
                    messageDiv.textContent = '채널 삭제 중 오류가 발생했습니다.';
                    messageDiv.className = 'message error';
                    
                    // 메시지 자동 사라짐
                    setTimeout(() => {
                        messageDiv.className = 'message';
                    }, 3000);
                });
            }
            
            function deleteKeyword(id) {
                fetch(`/api/v1/youtube/keywords/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        // 성공 메시지 표시
                        const messageDiv = document.getElementById('message');
                        messageDiv.textContent = '키워드가 삭제되었습니다.';
                        messageDiv.className = 'message success';
                        
                        // 목록 새로고침
                        loadKeywords();
                        
                        // 메시지 자동 사라짐
                        setTimeout(() => {
                            messageDiv.className = 'message';
                        }, 3000);
                    } else {
                        throw new Error('키워드 삭제 실패');
                    }
                })
                .catch(error => {
                    // 오류 메시지 표시
                    const messageDiv = document.getElementById('message');
                    messageDiv.textContent = '키워드 삭제 중 오류가 발생했습니다.';
                    messageDiv.className = 'message error';
                    
                    // 메시지 자동 사라짐
                    setTimeout(() => {
                        messageDiv.className = 'message';
                    }, 3000);
                });
            }
            
            // 폼 제출 이벤트 리스너
            const addChannelForm = document.getElementById('addChannelForm');
            if (addChannelForm) {
                addChannelForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const channelInput = document.getElementById('channelId');
                    const channelValue = channelInput.value.trim();
                    
                    if (!channelValue) {
                        alert('채널 ID 또는 URL을 입력해주세요.');
                        return;
                    }
                    
                    // 채널 추가 API 호출
                    fetch('/api/v1/youtube/channels/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            channel_id: channelValue
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('채널 추가 실패');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 입력 필드 초기화
                        channelInput.value = '';
                        
                        // 성공 메시지 표시
                        const messageDiv = document.getElementById('message');
                        messageDiv.textContent = '채널이 추가되었습니다.';
                        messageDiv.className = 'message success';
                        
                        // 목록 새로고침
                        loadChannels();
                        
                        // 메시지 자동 사라짐
                        setTimeout(() => {
                            messageDiv.className = 'message';
                        }, 3000);
                    })
                    .catch(error => {
                        // 오류 메시지 표시
                        const messageDiv = document.getElementById('message');
                        messageDiv.textContent = '채널 추가 중 오류가 발생했습니다.';
                        messageDiv.className = 'message error';
                        
                        // 메시지 자동 사라짐
                        setTimeout(() => {
                            messageDiv.className = 'message';
                        }, 3000);
                    });
                });
            }
            
            const addKeywordForm = document.getElementById('addKeywordForm');
            if (addKeywordForm) {
                addKeywordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const keywordInput = document.getElementById('keyword');
                    const keywordValue = keywordInput.value.trim();
                    
                    if (!keywordValue) {
                        alert('키워드를 입력해주세요.');
                        return;
                    }
                    
                    // 키워드 추가 API 호출
                    fetch('/api/v1/youtube/keywords/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            keyword: keywordValue
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('키워드 추가 실패');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 입력 필드 초기화
                        keywordInput.value = '';
                        
                        // 성공 메시지 표시
                        const messageDiv = document.getElementById('message');
                        messageDiv.textContent = '키워드가 추가되었습니다.';
                        messageDiv.className = 'message success';
                        
                        // 목록 새로고침
                        loadKeywords();
                        
                        // 메시지 자동 사라짐
                        setTimeout(() => {
                            messageDiv.className = 'message';
                        }, 3000);
                    })
                    .catch(error => {
                        // 오류 메시지 표시
                        const messageDiv = document.getElementById('message');
                        messageDiv.textContent = '키워드 추가 중 오류가 발생했습니다.';
                        messageDiv.className = 'message error';
                        
                        // 메시지 자동 사라짐
                        setTimeout(() => {
                            messageDiv.className = 'message';
                        }, 3000);
                    });
                });
            }
            
            // 리포트 탭 클릭 이벤트
            const reportTab = document.getElementById('report-tab');
            if (reportTab) {
                reportTab.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('리포트 기능은 현재 개발 중입니다.');
                });
            }
            
            // 초기 탭 설정
            switchTab(activeTab);
            
            // 채널 및 키워드 목록 로드
            loadChannels();
            loadKeywords();
        }
    </script>
</body>
</html>